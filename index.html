<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8"/>
<title>Índices Moveleiro — Modern Dashboard v3.8</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
:root {
  --bg: #dfe1e1;
  --card: #ffffff;
  --shadow: 0 3px 10px rgba(0,0,0,0.08);
  --title-bg: #000000;
  --title-fg: #ffffff;
  --accent: #f5b95f;
}
body {
  background: var(--bg);
  color:#111;
  font-family: Inter, Arial, sans-serif;
  margin:24px;
}
h1, h2 { margin: 0; }
section { margin-bottom: 34px; }
.titlebar {
  background: var(--title-bg);
  color: var(--title-fg);
  padding: 10px 16px;
  border-radius: 6px 6px 0 0;
  font-weight: 600;
  letter-spacing: .2px;
}
.card {
  background: var(--card);
  box-shadow: var(--shadow);
  border-radius: 0 0 10px 10px;
  padding: 16px;
}
.controls {
  display:flex;
  gap:10px;
  align-items:center;
  margin: 12px 0 8px 0;
  flex-wrap: wrap;
}
.status {
  margin-left:auto;
  font-size:12px;
  color:#333;
  background:#fff;
  padding:6px 10px;
  border:1px solid #e5e5e5;
  border-radius:8px;
}
input[type=date], button {
  padding: 8px 12px;
  border-radius:8px;
  border:1px solid #e5e5e5;
}
button { background:#f7f7f7; cursor:pointer; }
#chartGeral { width:100%; height:600px; }
#chartCRC, #chartIron, #chartFreight, #chartFX { width:100%; height:460px; }
.qgrid {
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:16px;
  margin:12px 0 8px 0;
}
.year-block {
  background:#f8f9fb;
  border-left:6px solid var(--accent);
  padding:10px 14px;
  border-radius:8px;
  box-shadow: var(--shadow);
}
.year-title { font-weight:600; margin-bottom:6px; color:#222; }
.last-month.left { margin-top:10px; color:#111; font-weight:600; }
.small { color:#666; font-size:12px; }
</style>
</head>
<body>
<section id="geral">
  <div class="titlebar">Índices Moveleiro</div>
  <div class="card">
    <div class="controls">
      <label>Data inicial: <input type="date" id="start"></label>
      <label>Data final: <input type="date" id="end"></label>
      <button id="apply">Aplicar filtro</button>
      <button id="download">Baixar CSV</button>
      <span id="info" class="small"></span>
      <span id="status" class="status"></span>
    </div>
    <div id="chartGeral"></div>
  </div>
</section>
<section id="crc">
  <div class="titlebar">Aço CRC China (USD/TON)</div>
  <div class="card">
    <div id="chartCRC"></div>
  </div>
</section>
<section id="iron">
  <div class="titlebar">Minério de Ferro (USD/TON)</div>
  <div class="card">
    <div id="chartIron"></div>
  </div>
</section>
<section id="freight">
  <div class="titlebar">Frete Marítimo (USD/TEU)</div>
  <div class="card">
    <div id="chartFreight"></div>
  </div>
</section>
<section id="fx">
  <div class="titlebar">Taxas de Câmbio (USD/BRL e USD/CNY)</div>
  <div class="card">
    <div id="chartFX"></div>
  </div>
</section>

<script>
// DADOS REAIS EXTRAÍDOS DO CSV "Indices_Moveleiro.csv"
const RAW = {
  date: [
    "2024-02-26","2024-03-11","2024-03-25","2024-04-08","2024-04-22","2024-05-13","2024-05-27",
    "2024-06-10","2024-06-24","2024-07-08","2024-07-22","2024-08-12","2024-08-26","2024-09-09",
    "2024-09-23","2024-10-14","2024-10-28","2024-11-11","2024-11-25","2024-12-09","2024-12-23",
    "2025-01-13","2025-01-27","2025-02-10","2025-02-24","2025-03-10","2025-03-24","2025-04-14",
    "2025-04-28","2025-05-12","2025-05-26","2025-06-09","2025-06-23","2025-07-14","2025-07-28",
    "2025-08-11","2025-08-25","2025-09-08","2025-09-22","2025-10-13"
  ],
  crc: [
    561,553,535,529,520,526,515,509,510,495,485,467,455,447,451,519,497,499,489,492,501,
    489,501,492,494,491,486,475,469,458,455,445,442,449,474,470,473,473,489,487
  ],
  iron: [
    113.89,109.61,106.05,110.16,106.55,117.02,117.52,107.33,106.51,109.58,106.86,97.81,
    98.7,92.26,92.98,105.37,102.49,101.63,102.44,105.31,103.9,101.21,101.59,106.83,106.9,
    102.85,102.43,100.05,98.19,100.08,99.12,95.38,94.49,97.22,99.57,101.59,101.81,105.43,
    105.44,105.35
  ],
  freight: [
    2315,2315,3265,3265,4815,4815,6464,6464,7464,7464,9715,9715,8081,8081,7700,7700,6800,
    6800,5600,5600,5600,3700,3700,3200,3200,2000,2000,1400,1400,2100,2100,5250,5250,6400,
    6400,3550,3550,2400,2400,2950
  ],
  usdbrl: [
    4.9813,4.9771,4.9863,5.0415,5.2037,5.1406,5.1698,5.366,5.3994,5.4714,5.5592,5.4905,
    5.4915,5.6091,5.544,5.6039,5.6982,5.7974,5.7996,6.0564,6.1606,6.1073,5.9266,5.7802,
    5.7252,5.7924,5.7397,5.8419,5.6675,5.6816,5.6613,5.5754,5.5207,5.5589,5.5871,5.4467,
    5.4168,5.4272,5.3451,5.4623
  ],
  usdcny: [
    7.1972,7.182,7.2102,7.2305,7.2403,7.2325,7.2425,7.2475,7.2586,7.2683,7.2736,7.1744,
    7.1212,7.1133,7.0508,7.0667,7.1254,7.1785,7.2395,7.2604,7.2977,7.3319,7.2507,7.3045,
    7.2476,7.2591,7.2531,7.3119,7.2942,7.2018,7.1798,7.1802,7.179,7.167,7.1778,7.1884,
    7.151,7.1293,7.114,7.134
  ]
};

function monthTicks(dates) {
  const PT_ABBR = ["JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ"];
  const seen = new Set(), tickvals=[], ticktext=[];
  for(let i=0;i<dates.length;i++){
    const dt=new Date(dates[i]);
    const key=dt.getFullYear()+"-"+(dt.getMonth()+1);
    if(!seen.has(key)){
      seen.add(key);
      tickvals.push(dates[i]);
      ticktext.push(PT_ABBR[dt.getMonth()]);
    }
  }
  return {tickvals,ticktext};
}

function drawAll(){
  const {tickvals,ticktext}=monthTicks(RAW.date);
  const lineCfg=(color)=>({
    mode:'lines+markers',
    line:{shape:'spline',smoothing:0.6,width:2.2,color:color},
    marker:{size:8,line:{width:1,color:'#fff'}}
  });

  // Gráfico Geral
  Plotly.newPlot('chartGeral',[
    {x:RAW.date,y:RAW.crc,name:'Aço CRC China (USD/TON)',...lineCfg('#007bff')},
    {x:RAW.date,y:RAW.iron,name:'Minério de Ferro (USD/TON)',...lineCfg('#ff6f00')},
    {x:RAW.date,y:RAW.freight,name:'Frete Marítimo (USD/TEU)',...lineCfg('#00bfa6')}
  ],{
    hovermode:'x unified',
    legend:{orientation:'h',y:1.12},
    xaxis:{tickmode:'array',tickvals,tickvals,ticktext:ticktext},
    yaxis:{title:'Valores em USD',gridcolor:'#e9ecef',zeroline:false},
    paper_bgcolor:'#fff',plot_bgcolor:'#fff',
    margin: {t: 60, b: 60, l: 60, r: 60}
  });

  // Gráfico de Câmbio (com eixos duplos)
  Plotly.newPlot('chartFX',[
    {x:RAW.date,y:RAW.usdbrl,name:'USD/BRL',...lineCfg('#7e57c2'),yaxis:'y'},
    {x:RAW.date,y:RAW.usdcny,name:'USD/CNY',...lineCfg('#e53935'),yaxis:'y2'}
  ],{
    hovermode:'x unified',
    legend:{orientation:'h',y:1.12},
    xaxis:{tickmode:'array',tickvals,tickvals,ticktext:ticktext},
    yaxis:{title:'USD/BRL',gridcolor:'#e9ecef',zeroline:false, range: [4.9, 6.2]},
    yaxis2:{title:'USD/CNY',overlaying:'y',side:'right',showgrid:false, range: [7.0, 7.4]},
    paper_bgcolor:'#fff',plot_bgcolor:'#fff',
    margin: {t: 60, b: 60, l: 60, r: 60}
  });

  // Gráficos individuais
  Plotly.newPlot('chartCRC',[{x:RAW.date,y:RAW.crc,name:'Aço CRC China (USD/TON)',...lineCfg('#007bff')}],
    {xaxis:{tickvals:tickvals,ticktext:ticktext},yaxis:{title:'USD/TON',gridcolor:'#e9ecef',zeroline:false}});

  Plotly.newPlot('chartIron',[{x:RAW.date,y:RAW.iron,name:'Minério de Ferro (USD/TON)',...lineCfg('#ff6f00')}],
    {xaxis:{tickvals:tickvals,ticktext:ticktext},yaxis:{title:'USD/TON',gridcolor:'#e9ecef',zeroline:false}});

  Plotly.newPlot('chartFreight',[{x:RAW.date,y:RAW.freight,name:'Frete Marítimo (USD/TEU)',...lineCfg('#00bfa6')}],
    {xaxis:{tickvals:tickvals,ticktext:ticktext},yaxis:{title:'USD/TEU',gridcolor:'#e9ecef',zeroline:false}});
}

drawAll();

// Filtro de data (opcional - ainda não implementado)
document.getElementById('apply').addEventListener('click', () => {
  alert('Filtro de data ainda não implementado. Use todos os dados por enquanto.');
});
</script>
</body>
</html>
