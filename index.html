
<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8"/>
<title>Índices Moveleiro — Modern Dashboard v3.7</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
:root {
  --bg: #dfe1e1;
  --card: #ffffff;
  --shadow: 0 3px 10px rgba(0,0,0,0.08);
  --title-bg: #000000;
  --title-fg: #ffffff;
  --accent: #f5b95f;
}
body { background: var(--bg); color:#111; font-family: Inter, Arial, sans-serif; margin:24px; }
h1, h2 { margin: 0; }
section { margin-bottom: 34px; }
.titlebar { background: var(--title-bg); color: var(--title-fg); padding: 10px 16px; border-radius: 6px 6px 0 0; font-weight: 600; letter-spacing: .2px; }
.card { background: var(--card); box-shadow: var(--shadow); border-radius: 0 0 10px 10px; padding: 16px; }
.controls { display:flex; gap:10px; align-items:center; margin: 12px 0 8px 0; flex-wrap: wrap; }
.status { margin-left:auto; font-size:12px; color:#333; background:#fff; padding:6px 10px; border:1px solid #e5e5e5; border-radius:8px; }
input[type=date], button { padding: 8px 12px; border-radius:8px; border:1px solid #e5e5e5; }
button { background:#f7f7f7; cursor:pointer; }
#chartGeral { width:100%; height:600px; }
#chartCRC, #chartIron, #chartFreight, #chartFX { width:100%; height:460px; }
.qgrid { display:grid; grid-template-columns: 1fr 1fr; gap:16px; margin:12px 0 8px 0; }
.year-block { background:#f8f9fb; border-left:6px solid var(--accent); padding:10px 14px; border-radius:8px; box-shadow: var(--shadow); }
.year-title { font-weight:600; margin-bottom:6px; color:#222; }
.last-month.left { margin-top:10px; color:#111; font-weight:600; }
.small { color:#666; font-size:12px; }
</style>
</head>
<body>

<section id="geral">
  <div class="titlebar">Índices Moveleiro</div>
  <div class="card">
    <div class="controls">
      <label>Data inicial: <input type="date" id="start"></label>
      <label>Data final: <input type="date" id="end"></label>
      <button id="apply">Aplicar filtro</button>
      <button id="download">Baixar CSV</button>
      <span id="info" class="small"></span>
      <span id="status" class="status"></span>
    </div>
    <div id="chartGeral"></div>
  </div>
</section>

<section id="crc">
  <div class="titlebar">Aço CRC China (USD/TON)</div>
  <div class="card">
    <div id="chartCRC"></div>
    <div class='qgrid'><div class='col'><div class='year-block'><div class='year-title'>2025</div><ul><li>1º trimestre (Janeiro – Março): -0.6%</li><li>2º trimestre (Abril – Junho): -6.9%</li><li>3º trimestre (Julho – Setembro): +8.9%</li><li>4º trimestre (Outubro – Dezembro): n/d</li></ul></div></div><div class='col'><div class='year-block'><div class='year-title'>2024</div><ul><li>1º trimestre (Janeiro – Março): -4.6%</li><li>2º trimestre (Abril – Junho): -3.6%</li><li>3º trimestre (Julho – Setembro): -8.9%</li><li>4º trimestre (Outubro – Dezembro): -3.5%</li></ul></div></div></div><div class='last-month left'>Último mês (SET – OUT 2025): -0.4%</div>
  </div>
</section>

<section id="iron">
  <div class="titlebar">Minério de Ferro (USD/TON)</div>
  <div class="card">
    <div id="chartIron"></div>
    <div class='qgrid'><div class='col'><div class='year-block'><div class='year-title'>2025</div><ul><li>1º trimestre (Janeiro – Março): +1.2%</li><li>2º trimestre (Abril – Junho): -5.6%</li><li>3º trimestre (Julho – Setembro): +8.5%</li><li>4º trimestre (Outubro – Dezembro): n/d</li></ul></div></div><div class='col'><div class='year-block'><div class='year-title'>2024</div><ul><li>1º trimestre (Janeiro – Março): -6.9%</li><li>2º trimestre (Abril – Junho): -3.3%</li><li>3º trimestre (Julho – Setembro): -15.1%</li><li>4º trimestre (Outubro – Dezembro): -1.4%</li></ul></div></div></div><div class='last-month left'>Último mês (SET – OUT 2025): -0.1%</div>
  </div>
</section>

<section id="freight">
  <div class="titlebar">Frete Marítimo (USD/TEU)</div>
  <div class="card">
    <div id="chartFreight"></div>
    <div class='qgrid'><div class='col'><div class='year-block'><div class='year-title'>2025</div><ul><li>1º trimestre (Janeiro – Março): -45.9%</li><li>2º trimestre (Abril – Junho): +275.0%</li><li>3º trimestre (Julho – Setembro): -62.5%</li><li>4º trimestre (Outubro – Dezembro): n/d</li></ul></div></div><div class='col'><div class='year-block'><div class='year-title'>2024</div><ul><li>1º trimestre (Janeiro – Março): +41.0%</li><li>2º trimestre (Abril – Junho): +128.6%</li><li>3º trimestre (Julho – Setembro): +3.2%</li><li>4º trimestre (Outubro – Dezembro): -27.3%</li></ul></div></div></div><div class='last-month left'>Último mês (SET – OUT 2025): +22.9%</div>
  </div>
</section>

<section id="fx">
  <div class="titlebar">Taxas de Câmbio (USD/BRL e USD/CNY)</div>
  <div class="card">
    <div id="chartFX"></div>
    <div class='qgrid'><div class='col'><div class='year-block'><div class='year-title'>2025</div><ul><li>1º trimestre (Janeiro – Março):<br/>USD/BRL -6.0%<br/>USD/CNY -1.1%</li><li>2º trimestre (Abril – Junho):<br/>USD/BRL -5.5%<br/>USD/CNY -1.8%</li><li>3º trimestre (Julho – Setembro):<br/>USD/BRL -3.8%<br/>USD/CNY -0.7%</li><li>4º trimestre (Outubro – Dezembro):<br/>USD/BRL n/d<br/>USD/CNY n/d</li></ul></div></div><div class='col'><div class='year-block'><div class='year-title'>2024</div><ul><li>1º trimestre (Janeiro – Março):<br/>USD/BRL +0.1%<br/>USD/CNY +0.2%</li><li>2º trimestre (Abril – Junho):<br/>USD/BRL +7.1%<br/>USD/CNY +0.4%</li><li>3º trimestre (Julho – Setembro):<br/>USD/BRL +1.3%<br/>USD/CNY -3.0%</li><li>4º trimestre (Outubro – Dezembro):<br/>USD/BRL +9.9%<br/>USD/CNY +3.3%</li></ul></div></div></div><div class='last-month left'>Último mês (SET – OUT 2025):<br/>USD/BRL +2.2%<br/>USD/CNY +0.3%</div>
  </div>
</section>

<script>
const __PAYLOAD__ = {"date": ["2024-02-26", "2024-03-11", "2024-03-25", "2024-04-08", "2024-04-22", "2024-05-13", "2024-05-27", "2024-06-10", "2024-06-24", "2024-07-08", "2024-07-22", "2024-08-12", "2024-08-26", "2024-09-09", "2024-09-23", "2024-10-14", "2024-10-28", "2024-11-11", "2024-11-25", "2024-12-09", "2024-12-23", "2025-01-13", "2025-01-27", "2025-02-10", "2025-02-24", "2025-03-10", "2025-03-24", "2025-04-14", "2025-04-28", "2025-05-12", "2025-05-26", "2025-06-09", "2025-06-23", "2025-07-14", "2025-07-28", "2025-08-11", "2025-08-25", "2025-09-08", "2025-09-22", "2025-10-13"], "crc": [561.0, 553.0, 535.0, 529.0, 520.0, 526.0, 515.0, 509.0, 510.0, 495.0, 485.0, 467.0, 455.0, 447.0, 451.0, 519.0, 497.0, 499.0, 489.0, 492.0, 501.0, 489.0, 501.0, 492.0, 494.0, 491.0, 486.0, 475.0, 469.0, 458.0, 455.0, 445.0, 442.0, 449.0, 474.0, 470.0, 473.0, 473.0, 489.0, 487.0], "iron": [113.89, 109.61, 106.05, 110.16, 106.55, 117.02, 117.52, 107.33, 106.51, 109.58, 106.86, 97.81, 98.7, 92.26, 92.98, 105.37, 102.49, 101.63, 102.44, 105.31, 103.9, 101.21, 101.59, 106.83, 106.9, 102.85, 102.43, 100.05, 98.19, 100.08, 99.12, 95.38, 94.49, 97.22, 99.57, 101.59, 101.81, 105.43, 105.44, 105.35], "freight": [2315.0, 2315.0, 3265.0, 3265.0, 4815.0, 4815.0, 6464.0, 6464.0, 7464.0, 7464.0, 9715.0, 9715.0, 8081.0, 8081.0, 7700.0, 7700.0, 6800.0, 6800.0, 5600.0, 5600.0, 5600.0, 3700.0, 3700.0, 3200.0, 3200.0, 2000.0, 2000.0, 1400.0, 1400.0, 2100.0, 2100.0, 5250.0, 5250.0, 6400.0, 6400.0, 3550.0, 3550.0, 2400.0, 2400.0, 2950.0], "usdbrl": [4.9813, 4.9771, 4.9863, 5.0415, 5.2037, 5.1406, 5.1698, 5.366, 5.3994, 5.4714, 5.5592, 5.4905, 5.4915, 5.6091, 5.544, 5.6039, 5.6982, 5.7974, 5.7996, 6.0564, 6.1606, 6.1073, 5.9266, 5.7802, 5.7252, 5.7924, 5.7397, 5.8419, 5.6675, 5.6816, 5.6613, 5.5754, 5.5207, 5.5589, 5.5871, 5.4467, 5.4168, 5.4272, 5.3451, 5.4623], "usdcny": [7.1972, 7.182, 7.2102, 7.2305, 7.2403, 7.2325, 7.2425, 7.2475, 7.2586, 7.2683, 7.2736, 7.1744, 7.1212, 7.1133, 7.0508, 7.0667, 7.1254, 7.1785, 7.2395, 7.2604, 7.2977, 7.3319, 7.2507, 7.3045, 7.2476, 7.2591, 7.2531, 7.3119, 7.2942, 7.2018, 7.1798, 7.1802, 7.179, 7.167, 7.1778, 7.1884, 7.151, 7.1293, 7.114, 7.134]};

const PT_ABBR = ["JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ"];
const RAW = __PAYLOAD__;

function filterData(s=null, e=null) {
  const S = s? new Date(s) : null;
  const E = e? new Date(e) : null;
  const out = {date:[], crc:[], iron:[], freight:[], usdbrl:[], usdcny:[]};
  for (let i=0;i<RAW.date.length;i++) {
    const d = new Date(RAW.date[i]);
    if ((S && d < S) || (E && d > E)) continue;
    out.date.push(RAW.date[i]);
    out.crc.push(RAW.crc[i]);
    out.iron.push(RAW.iron[i]);
    out.freight.push(RAW.freight[i]);
    out.usdbrl.push(RAW.usdbrl[i]);
    out.usdcny.push(RAW.usdcny[i]);
  }
  return out;
}

function monthTicks(dates) {
  const seen = new Set();
  const tickvals = [], ticktext = [];
  for (let i=0;i<dates.length;i++) {
    const dt = new Date(dates[i]);
    const key = dt.getFullYear()+"-"+(dt.getMonth()+1);
    if (!seen.has(key)) {
      seen.add(key);
      tickvals.push(dates[i]);
      ticktext.push(PT_ABBR[dt.getMonth()]);
    }
  }
  return {tickvals, ticktext};
}

function drawAll(s=null, e=null) {
  const D = filterData(s,e);
  const info = document.getElementById('info');
  if (info) info.innerText = D.date.length ? `Período: ${D.date[0]} a ${D.date[D.date.length-1]} — ${D.date.length} pontos` : '';
  const status = document.getElementById('status');
  if (status) {
    const flags = [
      ['Aço CRC', D.crc],
      ['Minério de Ferro', D.iron],
      ['Frete Marítimo', D.freight],
      ['USD/BRL', D.usdbrl],
      ['USD/CNY', D.usdcny]
    ].map(([name, arr]) => {
      const hasData = arr.some(v => v !== null && v !== undefined && !Number.isNaN(v));
      return `${name}: ${hasData ? '✅' : '⚠️ sem dados'}`;
    });
    status.innerText = flags.join(' | ');
  }
  const {tickvals, ticktext} = monthTicks(D.date);

  const lineCfg = (color) => ({
    mode:'lines+markers',
    line:{shape:'spline', smoothing:0.6, width:2.2, color:color},
    marker:{size:8, line:{width:1, color:'#fff'}}
  });

  Plotly.newPlot('chartGeral', [
    {x:D.date, y:D.crc, name:'Aço CRC China (USD/TON)', ...lineCfg('#007bff')},
    {x:D.date, y:D.iron, name:'Minério de Ferro (USD/TON)', ...lineCfg('#ff6f00')},
    {x:D.date, y:D.freight, name:'Frete Marítimo (USD/TEU)', ...lineCfg('#00bfa6')},
    {x:D.date, y:D.usdbrl.map(v=>v!=null? v*100 : v), name:'USD/BRL ×100', yaxis:'y2', ...lineCfg('#7e57c2')},
    {x:D.date, y:D.usdcny.map(v=>v!=null? v*100 : v), name:'USD/CNY ×100', yaxis:'y2', ...lineCfg('#e53935')},
  ], {
    hovermode:'x unified',
    legend:{orientation:'h', y:1.12},
    xaxis:{showgrid:false, tickmode:'array', tickvals: tickvals, ticktext: ticktext},
    yaxis:{gridcolor:'#e9ecef', zeroline:false, title:'USD/TON (CRC, Minério, Frete)'},
    yaxis2:{title:'Câmbio ×100', overlaying:'y', side:'right'},
    paper_bgcolor:'#ffffff', plot_bgcolor:'#ffffff',
    transition:{duration:300, easing:'cubic-in-out'}
  });

  const subLayout = {
    hovermode:'x unified',
    xaxis:{showgrid:false, tickmode:'array', tickvals: tickvals, ticktext: ticktext},
    yaxis:{gridcolor:'#e9ecef', zeroline:false},
    paper_bgcolor:'#ffffff', plot_bgcolor:'#ffffff'
  };

  Plotly.newPlot('chartCRC', [
    {x:D.date, y:D.crc, name:'Aço CRC China (USD/TON)', ...lineCfg('#007bff')}
  ], {...subLayout, yaxis:{...subLayout.yaxis, title:'USD/TON'}});

  Plotly.newPlot('chartIron', [
    {x:D.date, y:D.iron, name:'Minério de Ferro (USD/TON)', ...lineCfg('#ff6f00')}
  ], {...subLayout, yaxis:{...subLayout.yaxis, title:'USD/TON'}});

  Plotly.newPlot('chartFreight', [
    {x:D.date, y:D.freight, name:'Frete Marítimo (USD/TEU)', ...lineCfg('#00bfa6')}
  ], {...subLayout, yaxis:{...subLayout.yaxis, title:'USD/TEU'}});

  Plotly.newPlot('chartFX', [
    {x:D.date, y:D.usdbrl, name:'USD/BRL', ...lineCfg('#7e57c2')},
    {x:D.date, y:D.usdcny, name:'USD/CNY', yaxis:'y2', ...lineCfg('#e53935')}
  ], {...subLayout, yaxis:{...subLayout.yaxis, title:'USD/BRL'}, yaxis2:{title:'USD/CNY', overlaying:'y', side:'right'}});
}

drawAll();
document.getElementById('apply').addEventListener('click', ()=>{
  const s = document.getElementById('start').value || null;
  const e = document.getElementById('end').value || null;
  drawAll(s, e);
});
document.getElementById('download').addEventListener('click', ()=>{
  const s = document.getElementById('start').value || null;
  const e = document.getElementById('end').value || null;
  const S = s? new Date(s): null; const E = e? new Date(e): null;
  let csv = "date,Aço CRC China (USD/TON),Minério de Ferro (USD/TON),Frete Marítimo (USD/TEU),USD/BRL,USD/CNY\n";
  for (let i=0;i<__PAYLOAD__.date.length;i++) {
    const d = new Date(__PAYLOAD__.date[i]);
    if ((S && d < S) || (E && d > E)) continue;
    const row = [__PAYLOAD__.date[i], __PAYLOAD__.crc[i]??"", __PAYLOAD__.iron[i]??"", __PAYLOAD__.freight[i]??"", __PAYLOAD__.usdbrl[i]??"", __PAYLOAD__.usdcny[i]??""];
    csv += row.join(",") + "\n";
  }
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'indices_moveleiro_filtrado.csv'; a.click();
  URL.revokeObjectURL(url);
});
</script>

</body>
</html>
